<div id="full-screen-image">
  <button class="close-btn" title="Exit">
    <img
      matTooltip="Close"
      matTooltipClass="tooltip"
      matTooltipPosition="above"
      (click)="onCloseDialog()"
      class="mr-2 mt-1 close-icon"
      src="assets/img/svg/req-details/close-circle.svg"
      alt
    />
  </button>
  <img src alt id="image" />
</div>

<div class="main-content" *ngIf="screenWidth > 430">
  <div class="container-fluid" style="max-width: 100vw">
    <div
      class="d-flex w-100 justify-content-center align-items-center"
      *ngIf="isContentLoading"
      style="height: 800px"
    >
      <span class="spinner-border spinner-border-m mr-2" style="color: #d4aa32">
      </span>
    </div>

    <div class="row m-0 justify-content-between" *ngIf="!isContentLoading">
      <h4 class="item-header ml-4">User profile</h4>
      <img
        *ngIf="!isContentLoading"
        mat-button
        [matMenuTriggerFor]="menuEdit"
        class="mx-4"
        matTooltip="More Actions"
        matTooltipClass="tooltip"
        matTooltipPosition="above"
        src="assets/img/svg/home-page/more.svg"
        alt
        style="
          filter: brightness(0) saturate(100%) invert(73%) sepia(8%)
            saturate(14%) hue-rotate(333deg) brightness(91%) contrast(77%);
          width: 25px;
          cursor: pointer;
        "
      />
      <mat-menu #menuEdit="matMenu">
        <button mat-menu-item (click)="openEditUser()">Edit</button>
      </mat-menu>
    </div>

    <div class="row" *ngIf="!isContentLoading">
      <div class="col mt-3">
        <div
          class="row m-0 align-items-start justify-content-between"
          style="
            border: 1px solid #e6ebf1;
            background: white;
            padding: 20px 20px;
            border-radius: 5px;
          "
        >
          <div class="row m-0">
            <ngx-skeleton-loader
              *ngIf="is_user_image_loading"
              appearance="circle"
              [theme]="{ width: '115px', height: '115px' }"
            >
            </ngx-skeleton-loader>
            <img
              [ngStyle]="{'display':is_user_image_loading?'none':''}"
              src="{{profile_image}}"
              alt
              class="user-image"
              (click)="viewImageOfUnit()"
              (load)="finishLoadingImage()"
            />

            <div class="col mt-2">
              <p class="mb-2" style="font-size: 17px; font-weight: 500">
                {{all_data.user_name | titlecase}}
              </p>
              <span
                class="mb-0"
                style="
                  padding: 3px 10px;
                  border-radius: 5px;
                  background-color: #d4aa3226 !important;
                  border: 1px solid #d4aa3275;
                  color: #cb9909 !important;
                  font-size: 12px;
                  font-weight: 600;
                "
              >
                {{getUserType(all_data.user_type)}}
              </span>

              <p
                class="mt-2"
                style="font-size: 13px; font-weight: 600; color: #757b82bf"
              >
                Joined {{all_data.user_joined_date | date}}
              </p>
            </div>
          </div>
          <div class="row m-0">
            <div
              style="font-size: 13px; font-weight: 400"
              *ngIf="user_auth == 'owner'"
              class="mr-3"
            >
              Current Plan :
              <span
                style="
                  background: #4caf5017;
                  color: #4caf50;
                  border: 1px solid #4caf50;
                  font-size: 13px;
                  font-weight: 500;
                  padding: 3px 8px;
                  border-radius: 4px;
                "
                >Open</span
              >
            </div>
            <img
              matTooltip="Message"
              matTooltipClass="tooltip"
              matTooltipPosition="above"
              src="assets/img/svg/sidebar/messages-1.svg"
              alt=""
              style="
                cursor: pointer;
                filter: brightness(0) saturate(100%) invert(72%) sepia(0%)
                  saturate(9%) hue-rotate(146deg) brightness(90%) contrast(93%);
              "
            />
          </div>
        </div>
        <div class="card card-main mt-3 mb-0">
          <div class="card-header">
            <h4 class="title-header">Personel Informations</h4>
          </div>
          <div class="card-body">
            <div class="row m-0 mt-3">
              <div class="col-4 pl-0">
                <p class="mb-1 personel-info-tabs">Name</p>
                <p class="personel-info-tabs-val">{{all_data.user_name}}</p>
              </div>
              <div class="col">
                <p class="mb-1 personel-info-tabs">Email</p>
                <p class="personel-info-tabs-val">{{all_data.user_email}}</p>
              </div>
            </div>
            <div class="row m-0 mt-2">
              <div class="col-4 pl-0">
                <p class="mb-1 personel-info-tabs">Phone</p>
                <p class="personel-info-tabs-val">
                  {{all_data.user_country_code_number + ' ' +
                  all_data.user_mobile_number}}
                </p>
              </div>
              <div class="col">
                <p class="mb-1 personel-info-tabs">Nationality</p>
                <p class="personel-info-tabs-val">
                  {{all_data.user_nationality}}
                </p>
              </div>
            </div>
            <div class="row m-0 mt-2">
              <div class="col-4 pl-0">
                <p class="mb-1 personel-info-tabs">Date of Birth</p>
                <p class="personel-info-tabs-val">
                  {{all_data.user_dob | date:'M/d/y'}}
                </p>
              </div>
              <div class="col">
                <p class="mb-1 personel-info-tabs">Gender</p>
                <p class="personel-info-tabs-val">
                  {{all_data.user_gender != '' ? (all_data.user_gender |
                  titlecase) : '-'}}
                </p>
              </div>
            </div>
            <div class="row m-0 mt-2">
              <div class="col-4 pl-0">
                <p class="mb-1 personel-info-tabs">ID Type</p>
                <p class="personel-info-tabs-val">{{all_data.user_id_type}}</p>
              </div>
              <div class="col">
                <p class="mb-1 personel-info-tabs">ID Number</p>
                <p class="personel-info-tabs-val">
                  {{all_data.user_id_number}}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-4 pl-0">
        <div class="card card-main doc-column m-0 mt-3" style="height: 97%">
          <div class="card-header">
            <h4 class="title-header">User documents</h4>
          </div>
          <div class="card-body">
            <div
              class="row m-0 justify-content-between mb-3 docs-list"
              *ngFor="let item of user_doc; let index = i"
            >
              <p class="mb-0">{{item}}</p>

              <img
                matTooltip="Download"
                matTooltipClass="tooltip"
                matTooltipPosition="above"
                (click)="downloadDoc(item)"
                src="assets/img/svg/document-download.svg"
                alt
              />
            </div>
          </div>
        </div>
      </div>
    </div>

    <div
      class="row mt-3"
      *ngIf="!isContentLoading && all_data.user_allocates_unit != '' && user_auth == 'tenant'"
    >
      <div class="col-md-12 mx-auto" *ngIf="all_data.unit != 'none'">
        <div class="card card-main mb-0">
          <div class="card-header">
            <h4 class="title-header">
              {{is_object ? 'Tenant Unit' : 'Landlord Units'}}
            </h4>
          </div>
          <div class="card-body detail-table">
            <div class="table-row">
              <table
                class="teble table-striped w-100 px-3 detail-table"
                style="border-radius: 5px"
              >
                <thead class="thead">
                  <tr>
                    <th scope="col" class="p-3">unit number</th>
                    <th scope="col" class="p-3">address</th>
                    <th scope="col" class="p-3 d-flex justify-content-end">
                      link
                    </th>
                  </tr>
                </thead>
                <tbody class="tbody text-uppercase">
                  <ng-container *ngIf="is_object">
                    <tr scope="row">
                      <td class="p-3 col-md-2">
                        {{all_data.user_allocates_unit.unit_no}}
                      </td>
                      <td class="p-3 col-md-8">
                        {{ all_data.user_allocates_unit.prop_name + ', ' +
                        all_data.user_allocates_unit.prop_address}}
                      </td>
                      <td class="p-3 d-flex">
                        <button
                          (click)="navigateToUnit(all_data.user_allocates_unit.unit_id)"
                          class="btn open-external-link-icon"
                          title="extenal"
                        >
                          <img
                            src="assets/img/svg/common-icons/open-external-link-icon.svg"
                            alt
                          />
                        </button>
                      </td>
                    </tr>
                  </ng-container>
                  <ng-container *ngIf="!is_object">
                    <tr
                      scope="row"
                      *ngFor="let item of all_data.user_allocates_unit; let index = i"
                    >
                      <td class="p-3 col-md-2">{{item.unit_no}}</td>
                      <td class="p-3 col-md-8">
                        {{ item.prop_name + ', ' + item.prop_address}}
                      </td>
                      <td class="p-3 d-flex">
                        <button
                          (click)="navigateToUnit(item.unit_id)"
                          class="btn open-external-link-icon"
                          title="extenal"
                        >
                          <img
                            src="assets/img/svg/common-icons/open-external-link-icon.svg"
                            alt
                          />
                        </button>
                      </td>
                    </tr>
                  </ng-container>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div
      *ngIf="!isContentLoading && all_data.user_allocates_unit != '' && user_auth == 'owner'"
    >
      <p class="mt-3 ml-2" style="font-size: 17px; font-weight: 500">
        Landlord Units
      </p>
      <div
        *ngIf="pageChangeUnitsTable"
        style="
          position: absolute;
          width: 96%;
          height: 20rem;
          background: #ffffffba;
          text-align: center;
        "
      >
        <span
          class="spinner-border spinner-border-m mr-2"
          style="color: #d4aa32; margin-top: 10rem"
        >
        </span>
      </div>

      <table
        #table
        style="box-shadow: none; border: 1px solid #e0e0e0"
        mat-table
        [dataSource]="matTableDataSource"
        class="mat-elevation-z8 mt-3"
      >
        <ng-container matColumnDef="unit">
          <th mat-header-cell *matHeaderCellDef>Unit No.</th>
          <td mat-cell *matCellDef="let element">
            <span>{{ element.unit_no }}</span>
          </td>
        </ng-container>

        <!-- Name Column -->
        <ng-container matColumnDef="property">
          <th mat-header-cell *matHeaderCellDef>Property Name</th>
          <td mat-cell *matCellDef="let element">
            <span
              class="prop_name"
              (click)="navigateToProprety(element.property_id)"
              >{{ element.property_name | titlecase}}</span
            >
          </td>
        </ng-container>
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let element">
            <div
              *ngIf="element.status == 'vacant'"
              style="
                color: #2b333eb0;
                background: #2b333e1a;
                padding: 5px 0;
                border-radius: 5px;
                font-size: 13px;
                border: 1px solid #2b333e2e;
                text-align: center;
                font-weight: 600;
                max-width: 150px;
              "
            >
              VACANT
            </div>
            <div
              *ngIf="element.status == 'occupied'"
              style="
                color: #37b400;
                background: #37b4001c;
                padding: 5px 0;
                border-radius: 5px;
                font-size: 13px;
                border: 1px solid #37b4003b;
                text-align: center;
                font-weight: 600;
                max-width: 150px;
              "
            >
              OCCUPIED
            </div>
          </td>
        </ng-container>
        <ng-container matColumnDef="tenant">
          <th mat-header-cell *matHeaderCellDef>Tenant</th>
          <td mat-cell *matCellDef="let element">
            <span *ngIf="element.tenant_name == ''">-</span>
            <span
              class="prop_name"
              *ngIf="element.tenant_name != ''"
              (click)="navigateToUserDetails(element.tenant_id, 'tenant')"
              >{{element.tenant_name | titlecase}}</span
            >
          </td>
        </ng-container>
        <ng-container matColumnDef="link">
          <th mat-header-cell *matHeaderCellDef>Link</th>
          <td mat-cell *matCellDef="let element">
            <button
              (click)="navigateToUnit(element.unit_id)"
              class="btn open-external-link-icon"
              title="extenal"
            >
              <img
                src="assets/img/svg/common-icons/open-external-link-icon.svg"
                alt
              />
            </button>
          </td>
        </ng-container>

        <tr
          mat-header-row
          *matHeaderRowDef="displayedColumns"
          style="background: rgba(212, 170, 50, 0.0392156863)"
        ></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>

      <mat-paginator
        class="units-paginator mt-2"
        #paginator
        [pageSize]="5"
        [pageSizeOptions]="[5, 8]"
        [length]="tableLength"
        (page)="pageChange($event)"
        showFirstLastButtons
      ></mat-paginator>
    </div>
  </div>
</div>
